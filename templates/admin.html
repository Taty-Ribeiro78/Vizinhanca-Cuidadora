<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Painel Admin | Vizinhança Cuidadora</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Montserrat:wght@700&display=swap" rel="stylesheet" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: "#0a7489", secondary: "#f26522", "accent-teal": "#1ab1b8" },
                    fontFamily: { 'sans': ['Inter', 'sans-serif'], 'display': ['Montserrat', 'sans-serif'] }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen flex font-sans">

    <aside class="w-72 bg-white border-r border-slate-200 flex flex-col fixed h-full z-10">
        <div class="p-8 flex items-center gap-3">
            <img alt="Logo" class="h-10 w-10 rounded-lg object-cover shadow-md" src="{{ url_for('static', filename='img.jpg') }}">
            <h1 class="font-display font-bold text-sm leading-tight text-primary uppercase">Vizinhança<br /><span class="text-secondary">Cuidadora</span></h1>
        </div>

        <nav class="flex-1 px-4 mt-4 space-y-2">
            <button onclick="switchTab('validacao')" id="btn-validacao" class="tab-btn w-full flex items-center gap-3 px-4 py-4 rounded-xl font-bold transition-all bg-primary text-white shadow-lg">
                <span class="material-symbols-outlined">pending_actions</span>
                <span>Fila de Curadoria</span>
                <span class="ml-auto bg-white/20 text-[10px] px-2 py-1 rounded-full">{{ profissionais|length }}</span>
            </button>
            
            <button onclick="switchTab('dashboard')" id="btn-dashboard" class="tab-btn w-full flex items-center gap-3 px-4 py-4 text-slate-500 hover:bg-slate-50 rounded-xl transition-all font-semibold">
                <span class="material-symbols-outlined">monitoring</span>
                <span>Painel de Operações</span>
            </button>

            <a href="{{ url_for('admin_financas') }}" class="flex items-center gap-3 px-4 py-4 text-slate-500 hover:bg-slate-50 rounded-xl transition-all font-semibold">
                <span class="material-symbols-outlined">account_balance_wallet</span>
                <span>Financeiro</span>
            </a>
        </nav>

        <div class="p-6 border-t border-slate-100">
            <a href="/" class="flex items-center gap-2 text-sm text-slate-400 hover:text-red-500 font-medium">
                <span class="material-symbols-outlined text-base">logout</span> Sair do Painel
            </a>
        </div>
    </aside>

    <main class="ml-72 flex-1 p-12">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="mb-8 p-4 rounded-2xl border flex items-center gap-3 {% if category == 'success' %} bg-green-50 border-green-200 text-green-700 {% else %} bg-blue-50 border-blue-200 text-blue-700 {% endif %}">
                    <span class="material-symbols-outlined">{% if category == 'success' %}check_circle{% else %}info{% endif %}</span>
                    <p class="font-bold">{{ message }}</p>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <section id="tab-validacao">
            <header class="mb-12">
                <h2 class="text-4xl font-extrabold text-primary tracking-tight">Fila de Curadoria</h2>
                <p class="text-slate-500 mt-2 text-lg">Novos profissionais aguardando entrada na rede Stellar.</p>
            </header>

            <div class="grid gap-6 max-w-5xl">
                {% if profissionais %}
                    {% for pro in profissionais %}
                    <div class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex items-center justify-between">
                        <div class="flex items-center gap-6">
                            <div class="w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center text-primary font-black text-xl border">
                                {{ pro.nome[:2]|upper }}
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-slate-900">{{ pro.nome }}</h3>
                                <p class="text-primary font-medium">{{ pro.especialidade }} • {{ pro.localidade }}</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            {% if not pro.stellar_pubkey %}
                            <a href="{{ url_for('criar_carteira', id=pro.id) }}" class="px-6 py-3 bg-secondary text-white rounded-xl font-bold shadow-md hover:scale-105 transition-transform">
                                Ativar Carteira
                            </a>
                            {% else %}
                            <a href="{{ url_for('validar_profissional', id=pro.id) }}" class="px-6 py-3 bg-primary text-white rounded-xl font-bold shadow-md hover:scale-105 transition-transform text-sm flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">verified</span> Aprovar
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="p-12 text-center bg-white rounded-[2rem] border-2 border-dashed border-slate-200">
                        <p class="text-slate-400 font-medium">Nenhum profissional pendente no momento.</p>
                    </div>
                {% endif %}
            </div>
        </section>

        <section id="tab-dashboard" class="hidden">
            <header class="mb-12">
                <h2 class="text-4xl font-extrabold text-primary tracking-tight">Painel de Operações</h2>
                <p class="text-slate-500 mt-2 text-lg">Monitoramento em tempo real dos serviços da comunidade.</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-7 bg-white rounded-[2.5rem] border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">calendar_month</span>Próximos Serviços
                        </h3>
                    </div>
                    <div class="divide-y divide-slate-50">
                        {% for agend in agendamentos %}
                        <div class="p-5 flex items-center justify-between hover:bg-slate-50">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center text-primary font-bold text-xs">
                                    {{ agend.iniciais }}
                                </div>
                                <div>
                                    <p class="font-bold text-slate-900 text-sm">{{ agend.paciente }}</p>
                                    <p class="text-xs text-slate-400">{{ agend.endereco }}</p>
                                </div>
                            </div>
                            <span class="text-xs font-bold text-primary">{{ agend.horario }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="lg:col-span-5 space-y-6">
                    <div class="bg-slate-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden">
                        <div class="relative z-10">
                            <span class="text-[10px] font-black uppercase tracking-widest text-secondary">Status do Tesouro</span>
                            <h4 class="text-3xl font-bold mt-2">R$ 12.450,00</h4>
                            <p class="text-slate-400 text-xs mt-1">Saldo em tokens Stellar</p>
                        </div>
                        <div class="absolute -right-4 -bottom-4 opacity-10">
                            <span class="material-symbols-outlined !text-[120px]">account_balance</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        function switchTab(tab) {
            // Esconde todas as seções
            document.getElementById('tab-validacao').classList.add('hidden');
            document.getElementById('tab-dashboard').classList.add('hidden');
            
            // Remove estilos ativos de todos os botões
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white', 'shadow-lg');
                btn.classList.add('text-slate-500');
            });

            // Mostra a seção clicada
            document.getElementById('tab-' + tab).classList.remove('hidden');
            
            // Ativa o botão correspondente
            const activeBtn = document.getElementById('btn-' + tab);
            activeBtn.classList.add('bg-primary', 'text-white', 'shadow-lg');
            activeBtn.classList.remove('text-slate-500');
        }
    </script>
</body>
</html>